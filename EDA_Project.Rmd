---
title: "EDA Project Code Notebook"
author: "Gina Ge & Christina Fu"
date: "2025-10-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This project uses a subset of the 2024 National Health Interview Survey adult questionnaire to explore the relationship between sleep quality and mental health among U.S. adults. The NHIS is a survey conducted annually by the National Center for Health Statistics. From the dataset, we extracted data on sleep quality and mental-health diagnoses and recent care on anxiety, depression, and psychological distress. The motivation for the project is that sleep issues and mental health problems are becoming more widespread and normal common among adults and even teenagers. These issues could severely affect people's lives. Therefore, understanding how sleep quality correlates with mental health problems might help adults have healthier lives and better efficiency on work.

```{r}
#load the original dataset
data<- read.csv("/Users/apple/Desktop/adult24/adult24.csv")
dim(data)
```

```{r}
#Extract the 22 variable columns 
vars <- c(
  "ANXEV_A","DEPEV_A",
  "MHRX_A","MHTHRPY_A","MHTPYNOW_A","MHTHDLY_A","MHTHND_A",
  "SAD_A","NERVOUS_A","RESTLESS_A","HOPELESS_A","EFFORT_A","WORTHLESS_A",
  "CFSEV_A","CFSNOW_A",
  "SLPHOURS_A","SLPREST_A","SLPFLL_A","SLPSTY_A","SLPMED1_A","SLPMED2_A","SLPMED3_A"
)
id_like <- c("SEQN","RespondentID","ID")
vars <- unique(c(intersect(id_like, names(data)), vars))
keep <- intersect(vars, names(data))
out  <- data[ , keep, drop = FALSE]
out_path <- "./adult24_selected.csv"
write.csv(out, out_path, row.names = FALSE)

#Generate a new csv file containing only those variables 
cat("Saved:", out_path, "\nColumns:", paste(colnames(out), collapse=", "), "\n")
```

```{r}
#load the new dataset
data_selected<- read.csv("/Users/apple/Desktop/adult24/adult24_selected.csv")
```

## About the Dataset:

The dataset contains 32,629 observations with 630 variables, which provides information about 2024 NHIS data on survey participants.Taken only the variables, we need and discard the other variables. The new dataset(data_selected) contains only 22 variables. The variables are as follows:

-   ANXEV_A: Ever had an anxiety disorder; 1= Yes, 0=No
-   DEPEV_A: Ever had depression; 1=Yes, 0=No
-   MHRX_A: Took medication for other emotions, concentration, behavior, or mental health, past 12 months; 1=Yes, 0=No
-   MHTHRPY_A: Received counseling or therapy from mental health professional, past 12 months; 1=Yes, 0=No
-   MHTPYNOW_A: Currently receiving counseling or therapy from mental health professional, past 12 months; 1=Yes, 0=No
-   MHTHDLY_A: Delayed counseling or therapy due to cost, past 12 months
-   MHTHND_A: Needed counseling or therapy but did not get it due to cost, past 12 months
-   SAD_A: How often felt so sad nothing cheers you up, past 30 days; 1=all of the time, 2=most of the time, 3=some of the time, 4=a little of the time, 5=none of the time 
-   NERVOUS_A: How often felt nervous, past 30 days; 1=all of the time, 2=most of the time, 3=some of the time, 4=a little of the time, 5=none of the time 
-   RESTLESS_A: How often felt restless past 30 days; 1=all of the time, 2=most of the time, 3=some of the time, 4=a little of the time, 5=none of the time 
-   HOPELESS_A: How often felt hopeless, past 30 days; 1=all of the time, 2=most of the time, 3=some of the time, 4=a little of the time, 5=none of the time 
-   EFFORT_A: How often felt everything was an effort, past 30 days; 1=all of the time, 2=most of the time, 3=some of the time, 4=a little of the time, 5=none of the time 
-   WORTHLESS_A: How often felt worthless, past 30 days; 1=all of the time, 2=most of the time, 3=some of the time, 4=a little of the time, 5=none of the time 
-   CFSEV_A: Ever had Chronic Fatigue Syndrome; 1=Yes, 0=No
-   CFSNOW_A: Still have Chronic Fatigue Syndrome; 1=Yes, 0=No
-   SLPHOURS_A: Hours of sleep in a 24-hour period
-   SLPREST_A: Wake up well rested, past 30 days; 1=Always, 2=Most of the time, 3=Sometimes, 4=Rarely
-   SLPFLL_A: Trouble falling asleep, past 30 days; 1=Always, 2=Most of the time, 3=Sometimes, 4=Rarely
-   SLPSTY_A: Trouble staying asleep, past 30 days; 1=Always, 2=Most of the time, 3=Sometimes, 4=Rarely
-   SLPMED1_A: Take prescribed medication for sleep, past 30 days; 1=Yes, 0=No
-   SLPMED2_A: Take OTC medication for sleep, past 30 days; 1=Yes, 0=No
-   SLPMED3_A: Take MJ/CBD for sleep, past 30 days; 1=Yes, 0=No

## Data Cleaning:

Respondent in the survey could provide answers that are unrelated to our research proposal and thus data cleaning is necessary. Variable names should be renamed for better reference in the later. Regrouping variables and eliminating missing values are sometimes needed. The code chunk below demonstrates how the dataset is cleaned.

```{r}
library(dplyr)
library(stringr)
# Rename the variable columns 
data_selected <- data_selected %>%
  rename(
    anxiety_ever       = "ANXEV_A",
    depression_ever       = "DEPEV_A",
    medication_past12     = "MHRX_A",
    therapy_past12 = "MHTHRPY_A",
    therapy_now = "MHTPYNOW_A",
    delay_therapy  = "MHTHDLY_A",
    need_therapy = "MHTHND_A",
    sad_30d        = "SAD_A",
    nervous_30d    = "NERVOUS_A",
    restless_30d   = "RESTLESS_A",
    hopeless_30d   = "HOPELESS_A",
    effort_30d     = "EFFORT_A",
    worthless_30d  = "WORTHLESS_A",
    cfs_ever       ="CFSEV_A",
    cfs_now        = "CFSNOW_A",
    sleep_hours    = "SLPHOURS_A",
    well_rested    = "SLPREST_A",
    trouble_fall_asleep    = "SLPFLL_A",
    trouble_stay_asleep     ="SLPSTY_A",
    prescribe_med_sleep = "SLPMED1_A",
    otc_med_sleep  = "SLPMED2_A",
    mj_sleep   = "SLPMED3_A"
  )
```

```{r}
#inspect the summary statistics of the dataset 
summary(data_selected)
```

```{r}
#Convert responses with 7, 8, 9 97, 98, 99, 997, 998, 999 to NA
na_codes <- c(7,8,9, 97,98,99, 997,998,999)
data_selected <- data_selected %>%
  mutate(across(everything(), ~na_if(., 7))) %>%
  mutate(across(everything(), ~na_if(., 8))) %>%
  mutate(across(everything(), ~na_if(., 9))) %>%
  mutate(across(everything(), ~na_if(., 97))) %>%
  mutate(across(everything(), ~na_if(., 98))) %>%
  mutate(across(everything(), ~na_if(., 99))) %>%
  mutate(across(everything(), ~na_if(., 997))) %>%
  mutate(across(everything(), ~na_if(., 998))) %>%
  mutate(across(everything(), ~na_if(., 999)))
```

```{r}
# convert responses with out of range number of sleep hours to NA
if ("sleep_hours" %in% names(data_selected)) {
  data_selected <- data_selected %>%
    mutate(sleep_hours = ifelse(sleep_hours >= 0 & sleep_hours <= 24, sleep_hours, NA_real_))
}
```

```{r}
#regroup those variables to 1(Yes), 0(No)
bin_vars <- c(
  "anxiety_ever","depression_ever","medication_past12",
  "therapy_past12","therapy_now","delay_therapy", "need_therapy", "cfs_ever","cfs_now",
  "prescribe_med_sleep","otc_med_sleep","mj_sleep"
)
data_selected <- data_selected %>%
  mutate(across(all_of(bin_vars),
                ~ case_when(. == 1 ~ 1L,
                            . == 2 ~ 0L,
                            TRUE ~ as.integer(NA)),
                .names = "{.col}"))
```

```{r}
summary(data_selected)
```

```{r}
#recode emotion variables with readable categories 
emotion_vars <- c("sad_30d","nervous_30d","restless_30d",
             "hopeless_30d","effort_30d","worthless_30d")
emotion_labels <- c("All of the time",
               "Most of the time",
               "Some of the time",
               "A little of the time",
               "None of the time")
data_selected <- data_selected %>%
  mutate(
    across(all_of(emotion_vars), ~ {
      x <- suppressWarnings(as.numeric(as.character(.)))   
      factor(x, levels = 1:5, labels = emotion_labels, ordered = TRUE)
    }))
```

```{r}
table(data_selected$sad_30d)
```

```{r}
#recode sleep variables with readable categories 
sleep_vars<-c("well_rested","trouble_fall_asleep","trouble_stay_asleep")
sleep_labels<-c("Always", "Most of the time", "Sometimes", "Rarely")
data_selected <- data_selected %>%
  mutate(
    across(all_of(sleep_vars), ~ {
      x <- suppressWarnings(as.numeric(as.character(.)))   
      factor(x, levels = 1:4, labels = sleep_labels, ordered = TRUE)
    }))
```

```{r}
table(data_selected$well_rested)
```


22 variables have been cleaned and recorded.The summary statistics of uncleaned variables suggest that some variables responses with special missing values. For example, the variable anxiety_ever have a max 9, which should be considered as an NA. In addition, sleep_hours columns have a max 99, which is impossible given only 24 hours range. Therefore, we need to set those out of range numbers to NA. After cleaning the variables and regroup variables into Yes(1) and No(0), the summary statistics do not show out of bound values and special missing values. Other than missing values, sleep variables and emotion variables are all recoded into readable categories, ranked from always to rarely/none of the time. The recoded labels could create a better understanding of the relationship between variables in the data visualization section.

## Data Distributions:

#### Hours Slept Daily

```{r}
library(ggplot2)

# Summary Statistics
summary(data_selected$sleep_hours)

# Histogram
ggplot(data_selected, aes(x = sleep_hours)) +
  geom_histogram(binwidth = 0.5) +
  scale_x_continuous(breaks = seq(0, 24, by = 1)) +
  labs(x = "Hours of sleep per day", y = "Count",
       title = "Distribution of reported sleep duration") +
  theme_minimal()
```

The distribution of hours slept in a 24-hour period appears to be fairly normally distributed with the mean being 7.124 hours and the median being 7 hours.

#### Relevant Mental Health Variables

```{r}
# Therapy/Counseling Received
ggplot(data_selected, aes(x = factor(therapy_past12))) +
  geom_bar() +
  labs(x = "Received counseling/therapy within past 12 months", y = "Count",
       title = "Therapy usage among respondents") +
  theme_minimal()

# Restlessness (indicator of psychological distress)
ggplot(data_selected, aes(x = factor(restless_30d), y = sleep_hours)) +
  geom_boxplot() +
  labs(x = "Restlessness level", y = "Hours of sleep",
       title = "Sleep duration vs. restlessness") +
  theme_minimal()
```

## Data Analysis:

#### Is there a correlation betweeen duration of sleep and restlessness?

```{r}
spearman_result <-cor.test(data_selected$sleep_hours, data_selected$restless_30d,  method = "spearman")
spearman_result

ggplot(data_selected, aes(x = sleep_hours, y = restless_30d)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  labs(
    title = "Relationship between sleep duration and restlessness",
    x = "Restlessness level",
    y = "Sleep duration (hours)"
  ) +
  theme_minimal()
```

The correlation coefficient between hours slept and restlessness is 0.1219049 and the p-value is less than 2.2e-16. Because the correlation coefficient is close to 0, there is almost no association between the two variables.

### Is there a correlation betweeen duration of sleep and other feelings indicative of serious psychological distress?

```{r}

```

### What is the mean sleep for those with anxiety & depression compared to those without?

```{r}
# Creating a variable that combines depression & anxiety variables
data_selected <- data_selected %>%
  mutate(
    depression_ever = ifelse(depression_ever %in% c(7, 8, 9), NA, depression_ever),
    anxiety_ever = ifelse(anxiety_ever %in% c(7, 8, 9), NA, anxiety_ever),
    mh_group = case_when(
      depression_ever == 1 & anxiety_ever == 1 ~ "Both depression and anxiety",
      depression_ever == 1 & anxiety_ever == 2 ~ "Depression only",
      depression_ever == 2 & anxiety_ever == 1 ~ "Anxiety only",
      depression_ever == 2 & anxiety_ever == 2 ~ "Neither",
      TRUE ~ NA_character_
    )
  )
table(data_selected$mh_group)

# Visualization
data_selected %>%
  group_by(mh_group) %>%
  summarise(avg_sleep = mean(sleep_hours, na.rm = TRUE), sd_sleep = sd(sleep_hours, na.rm = TRUE), n = n()) %>%
  ggplot(aes(x = mh_group, y = avg_sleep, ymin = avg_sleep - sd_sleep, ymax = avg_sleep + sd_sleep)) +
    geom_col(fill = "lightblue") +
    geom_errorbar(width = 0.2) +
    labs(x = "Mental health disorder", y = "Mean hours of sleep",
         title = "Average sleep by prevalence of anxiety and depression") +
  theme_minimal()

# ANOVA test to determine if there is a significant difference in means
anova_result <- aov(sleep_hours ~ mh_group, data = data_selected)
summary(anova_result)
# p-value = 8.21e-07 which suggests a significant difference in means across groups
```

#### Does waking up feeling well-rested differ based on whether the individual has depression and/or anxiety?

```{r}

```

## Conclusion
